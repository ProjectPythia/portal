ion:
  schedule:
    # Weekly Every Monday at 1PM UTC
    - cron:  '0 13 * * 1'

jobs:
  main:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3
      - name: Install Flutter SDK
        uses: mobiledevops/secret-to-file-action@v1
        with:
          base64-encoded-secret: ${{ secrets.GOOGLE_ANALYTICS_API_CREDENTIALS }}
          filename: "credentials.json"
          is-executable: true
          working-directory: "./a/b/c"
      - run: export GOOGLE_APPLICATION_CREDENTIALS="credentials.json"

      - name: Create Virtual Environment
      - run:
          python3 -m venv analytics-api
          source analytics-api/bin/activate
          pip install google-analytics-data

      - name: Get Metrics
      - run: 
        python
        import get-metrics
        portal = get-metrics.run_total_users_report(${{ secrets.GA4_PORTAL_ID }})
        foundations = get-metrics.run_total_users_report(${{ secrets.GA4_FOUNDATIONS_ID }})
        cookbooks = get-metrics.run_total_users_report(${{ secrets.GA4_COOKBOOKS_ID }})

      - name: Update Site
      # run an if check to only open a PR if metrics have changed by a certain margin?
